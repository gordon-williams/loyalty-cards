<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Loyalty Cards</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%236366f1' width='100' height='100' rx='20'/><text x='50' y='65' font-size='50' text-anchor='middle' fill='white'>LC</text></svg>">
    <link rel="stylesheet" href="style.css?v=29">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <h1>Loyalty Cards</h1>
            <button class="icon-btn" id="settingsBtn" aria-label="Settings">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/>
                </svg>
            </button>
        </header>

        <!-- Search Bar -->
        <div class="search-container">
            <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
            </svg>
            <input type="text" id="searchInput" placeholder="Search cards..." autocomplete="off">
        </div>

        <!-- Category Filter -->
        <div class="category-filter" id="categoryFilter">
            <button class="category-btn active" data-category="all">All</button>
            <button class="category-btn" data-category="nearby">Nearby</button>
            <button class="category-btn" data-category="grocery">Grocery</button>
            <button class="category-btn" data-category="coffee">Coffee</button>
            <button class="category-btn" data-category="retail">Retail</button>
            <button class="category-btn" data-category="restaurant">Restaurant</button>
            <button class="category-btn" data-category="pharmacy">Pharmacy</button>
            <button class="category-btn" data-category="other">Other</button>
        </div>

        <!-- Cards List -->
        <main class="cards-container" id="cardsContainer">
            <div class="empty-state" id="emptyState">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <rect x="2" y="5" width="20" height="14" rx="2"/>
                    <path d="M2 10h20"/>
                </svg>
                <h2>No loyalty cards yet</h2>
                <p>Tap the + button to add your first card</p>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-btn" id="scanBtn" aria-label="Scan card">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 7V5a2 2 0 012-2h2M17 3h2a2 2 0 012 2v2M21 17v2a2 2 0 01-2 2h-2M7 21H5a2 2 0 01-2-2v-2"/>
                    <line x1="7" y1="12" x2="17" y2="12"/>
                    <line x1="7" y1="8" x2="17" y2="8"/>
                    <line x1="7" y1="16" x2="17" y2="16"/>
                </svg>
                <span>Scan</span>
            </button>
            <button class="nav-btn add-btn" id="addBtn" aria-label="Add card">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                    <path d="M12 5v14M5 12h14"/>
                </svg>
            </button>
            <button class="nav-btn" id="backupBtn" aria-label="Backup">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                <span>Backup</span>
            </button>
        </nav>
    </div>

    <!-- Add/Edit Card Modal -->
    <div class="modal" id="cardModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add Card</h2>
                <button class="icon-btn close-btn" id="closeModal" aria-label="Close">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <form id="cardForm">
                <input type="hidden" id="cardId">
                <div class="form-group">
                    <label for="cardName">Store Name</label>
                    <input type="text" id="cardName" required placeholder="e.g., Starbucks">
                </div>
                <div class="form-group">
                    <label for="cardNumber">Card Number</label>
                    <input type="text" id="cardNumber" required placeholder="Enter card number">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="barcodeFormat">Barcode Format</label>
                        <select id="barcodeFormat">
                            <option value="CODE128">CODE128</option>
                            <option value="CODE39">CODE39</option>
                            <option value="EAN13">EAN-13</option>
                            <option value="EAN8">EAN-8</option>
                            <option value="UPC">UPC-A</option>
                            <option value="ITF">ITF</option>
                            <option value="QR">QR Code</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="cardCategory">Category</label>
                        <select id="cardCategory">
                            <option value="grocery">Grocery</option>
                            <option value="coffee">Coffee</option>
                            <option value="retail">Retail</option>
                            <option value="restaurant">Restaurant</option>
                            <option value="pharmacy">Pharmacy</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="cardColor">Card Color</label>
                    <div class="color-picker" id="colorPicker">
                        <button type="button" class="color-option" data-color="#6366f1" style="background:#6366f1"></button>
                        <button type="button" class="color-option" data-color="#ec4899" style="background:#ec4899"></button>
                        <button type="button" class="color-option" data-color="#10b981" style="background:#10b981"></button>
                        <button type="button" class="color-option" data-color="#f59e0b" style="background:#f59e0b"></button>
                        <button type="button" class="color-option" data-color="#ef4444" style="background:#ef4444"></button>
                        <button type="button" class="color-option" data-color="#3b82f6" style="background:#3b82f6"></button>
                        <button type="button" class="color-option" data-color="#8b5cf6" style="background:#8b5cf6"></button>
                        <button type="button" class="color-option" data-color="#64748b" style="background:#64748b"></button>
                    </div>
                    <input type="hidden" id="cardColor" value="#6366f1">
                </div>
                <div class="form-group">
                    <label for="cardNotes">Notes (optional)</label>
                    <textarea id="cardNotes" rows="2" placeholder="Any additional notes..."></textarea>
                </div>
                <div class="form-group location-group">
                    <label>Location</label>
                    <div class="location-display" id="locationDisplay">
                        <span id="cardLocationText">No location set</span>
                        <button type="button" class="btn btn-small" id="captureLocationBtn" title="Use current location">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                <circle cx="12" cy="12" r="3"/>
                                <path d="M12 2v4M12 18v4M2 12h4M18 12h4"/>
                            </svg>
                        </button>
                        <button type="button" class="btn btn-small" id="clearLocationBtn" title="Clear location">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                        </button>
                    </div>
                    <div class="location-search">
                        <input type="text" id="addressSearch" placeholder="Search address...">
                        <button type="button" class="btn btn-small" id="searchAddressBtn" title="Search">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="M21 21l-4.35-4.35"/>
                            </svg>
                        </button>
                    </div>
                    <div class="search-results" id="searchResults"></div>
                    <input type="hidden" id="cardLat">
                    <input type="hidden" id="cardLng">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="deleteCardBtn" style="display:none">Delete</button>
                    <button type="submit" class="btn btn-primary">Save Card</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Card Detail/Fullscreen Modal -->
    <div class="modal fullscreen-modal" id="detailModal">
        <div class="modal-content detail-content">
            <div class="detail-header">
                <button class="icon-btn back-btn" id="closeDetail" aria-label="Back">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"/>
                    </svg>
                </button>
                <h2 id="detailName">Card Name</h2>
                <button class="icon-btn" id="editCardBtn" aria-label="Edit">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                </button>
            </div>
            <div class="barcode-container" id="barcodeContainer">
                <svg id="barcodeSvg"></svg>
                <canvas id="qrcodeCanvas"></canvas>
            </div>
            <p class="card-number-display" id="cardNumberDisplay"></p>
            <p class="card-notes-display" id="cardNotesDisplay"></p>
            <button class="btn btn-fullscreen" id="fullscreenBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 3 21 3 21 9"/>
                    <polyline points="9 21 3 21 3 15"/>
                    <line x1="21" y1="3" x2="14" y2="10"/>
                    <line x1="3" y1="21" x2="10" y2="14"/>
                </svg>
                Fullscreen
            </button>
        </div>
    </div>

    <!-- Scanner Modal -->
    <div class="modal" id="scannerModal">
        <div class="modal-content scanner-content">
            <div class="modal-header">
                <h2>Scan Card</h2>
                <button class="icon-btn close-btn" id="closeScannerModal" aria-label="Close">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div id="scannerView"></div>
            <div class="scanner-actions">
                <button class="btn btn-secondary" id="uploadImageBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/>
                        <polyline points="21 15 16 10 5 21"/>
                    </svg>
                    Upload Image
                </button>
                <input type="file" id="imageInput" accept="image/*" style="display:none">
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="icon-btn close-btn" id="closeSettings" aria-label="Close">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="settings-list">
                <div class="setting-item">
                    <span>Theme</span>
                    <select id="themeSelect">
                        <option value="auto">Auto</option>
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                    </select>
                </div>
                <div class="setting-item">
                    <span>Sort By</span>
                    <select id="sortSelect">
                        <option value="name">Name</option>
                        <option value="recent">Recently Used</option>
                        <option value="category">Category</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Backup Modal -->
    <div class="modal" id="backupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Backup & Restore</h2>
                <button class="icon-btn close-btn" id="closeBackup" aria-label="Close">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="backup-actions">
                <button class="btn btn-primary backup-btn" id="exportBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Export Cards
                </button>
                <button class="btn btn-secondary backup-btn" id="importBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    Import Cards
                </button>
                <input type="file" id="importInput" accept=".json" style="display:none">
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
